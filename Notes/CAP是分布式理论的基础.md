
分布式系统非常关注三个指标：

-（1）数据一致性；

-（2）系统可用性；

-（3）节点连通性与扩展性；

这三个指标的关系如何，今天来聊一聊分布式理论的基础CAP。



## 什么是数据一致性？

数据“强一致性”，是希望系统只读到最新写入的数据，例如：通过单点串行化的方式，就能够达到这个效果。



关于session一致性，DB主从一致性，DB双主一致性，DB与Cache一致性，数据冗余一致性，消息时序一致性，分布式事务一致性，库存扣减一致性，都存在类似的一致性问题。



## 什么可用性？

如果系统每运行100个时间单位，会有1个时间单位无法提供服务，则说系统的可用性是99%。



可用性和可靠性是比较容易搞混的两个指标，以一台取款机为例：

-（1）正确的输入，能够取到正确的钱，表示系统可靠；

-（2）取款机7*24小时提供服务，表示系统可用；



## 保证系统高可用的方法是：

-（1）冗余；

-（2）故障自动转移；



## 什么是连通性与扩展性？

分布式系统，往往有多个节点，每个节点之间，都不是完全独立的，需要相互通信，当发生节点无法联通时，数据是否还能保持一致，系统要如何进行容错处理，是需要考虑的。



同时，连通性和扩展性紧密相关，想要加机器扩展性能，必须有良好的连通性。当一个节点脱离系统，系统就出现问题，往往意味着系统是无法扩展的。



## 什么是CAP定理？

CAP定理，是对上述分布式系统的三个特性，进行了归纳：

-（1）一致性(Consistency)；

-（2）可用性(Availability)；

-（3）分区容忍性(Partition Tolerance)；

并且，定理指出，在系统实现时，这三者最多兼顾两点。



一致性，可用性，多节点扩展性三者只能取其二，既然加锁已经加上，常见的最佳工程架构实践是什么呢？

互联网，最常见的实践是这样的：

-（1）节点连通性，多节点扩展性，连通性异常的处理必须保证，满足P；

-（2）一致性C与可用性A一般二选一；

-（3）选择一致性C，举例：传统单库水平切分，就是这类选型的典型；

-（4）选择可用性A，举例：双主库同步高可用，就是这类选型的典型；



## 强一致很难怎么办？

单点串行化，虽然能保证“强一致”，但对系统的并发性能，以及高可用有较大影响，互联网的玩法，更多的是“最终一致性”，短期内未必读到最新的数据，但在一个可接受的时间窗口之后，能够读到最新的数据。



例如：数据库主从同步，从库上的数据，就是一个最终的一致。



## 总结

-（1）CAP可以理解为一致性，可用性，联通与扩展性；

-（2）CAP三者只能取其二；

-（3）最常见的实践是AP+最终一致性；
